const metingApi="https://meting.vercel.islu.cn/api?server=:server&type=:type&id=:id&r=:r";function _objectSpread(t){for(var e=1;e<arguments.length;e++){var i=null==arguments[e]?{}:arguments[e],a=Object.keys(i);(a="function"==typeof Object.getOwnPropertySymbols?a.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable})):a).forEach(function(e){_defineProperty(t,e,i[e])})}return t}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class MetingJSElement extends HTMLElement{connectedCallback(){window.APlayer&&window.fetch&&(this._init(),this._parse())}disconnectedCallback(){this.lock||this.aplayer.destroy()}_camelize(e){return e.replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,(e,t)=>t.toUpperCase())}_init(){var t={};for(let e=0;e<this.attributes.length;e+=1)t[this._camelize(this.attributes[e].name)]=this.attributes[e].value;var e=["server","type","id","api","auth","auto","lock","name","title","artist","author","url","cover","pic","lyric","lrc"];this.meta={};for(var i=0;i<e.length;i++){var a=e[i];this.meta[a]=t[a],delete t[a]}this.config=t,this.api=this.meta.api||window.meting_api||""+metingApi,this.meta.auto&&this._parse_link()}_parse_link(){for(var e=[["music.163.com.*song.*id=(\\d+)","netease","song"],["music.163.com.*album.*id=(\\d+)","netease","album"],["music.163.com.*artist.*id=(\\d+)","netease","artist"],["music.163.com.*playlist.*id=(\\d+)","netease","playlist"],["music.163.com.*discover/toplist.*id=(\\d+)","netease","playlist"],["y.qq.com.*song/(\\w+).html","tencent","song"],["y.qq.com.*album/(\\w+).html","tencent","album"],["y.qq.com.*singer/(\\w+).html","tencent","artist"],["y.qq.com.*playsquare/(\\w+).html","tencent","playlist"],["y.qq.com.*playlist/(\\w+).html","tencent","playlist"],["xiami.com.*song/(\\w+)","xiami","song"],["xiami.com.*album/(\\w+)","xiami","album"],["xiami.com.*artist/(\\w+)","xiami","artist"],["xiami.com.*collect/(\\w+)","xiami","playlist"]],t=0;t<e.length;t++){var i=e[t],a=new RegExp(i[0]).exec(this.meta.auto);if(null!==a)return this.meta.server=i[1],this.meta.type=i[2],void(this.meta.id=a[1])}}_parse(){var e;this.meta.url?((e={name:this.meta.name||this.meta.title||"Audio name",artist:this.meta.artist||this.meta.author||"Audio artist",url:this.meta.url,cover:this.meta.cover||this.meta.pic,lrc:this.meta.lrc||this.meta.lyric||"",type:this.meta.type||"auto"}).lrc||(this.meta.lrcType=0),this.innerText&&(e.lrc=this.innerText,this.meta.lrcType=2),this._loadPlayer([e])):(e=this.api.replace(":server",this.meta.server).replace(":type",this.meta.type).replace(":id",this.meta.id).replace(":auth",this.meta.auth).replace(":r",Math.random()),fetch(e).then(e=>e.json()).then(e=>this._loadPlayer(e)))}_loadPlayer(e){var t={audio:e,mutex:!0,lrcType:this.meta.lrcType||3,storageName:"metingjs"};if(e.length){var i,a=_objectSpread({},t,this.config);for(i in a)"true"!==a[i]&&"false"!==a[i]||(a[i]="true"===a[i]);e=document.createElement("div");a.container=e,this.appendChild(e),this.aplayer=new APlayer(a)}}}window.customElements&&!window.customElements.get("meting-js")&&(window.MetingJSElement=MetingJSElement,window.customElements.define("meting-js",MetingJSElement));